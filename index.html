<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nalanda Nexus AI - Exoplanet Discovery Platform</title>

  <!-- Inter Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet" />
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />

  <style>
    /* Theme: Dark Charcoal/Space Black (#121212), NASA Orange (#FF6F00), Teal/Green (#00BFA6) */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      transition: all 0.3s ease-out; /* Smooth transitions for visual changes */
    }

    body {
      font-family: "Inter", sans-serif;
      background: #121212;
      color: #b0b0b0;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Utility Classes */
    .text-white { color: #ffffff; }
    .text-orange { color: #ff6f00; }
    .text-teal { color: #00bfa6; }
    .bg-orange-gradient { background: linear-gradient(135deg, #ff6f00, #ff9933); }

    /* Header Styling */
    .header {
      background: rgba(18, 18, 18, 0.9);
      backdrop-filter: blur(10px);
      padding: 1rem 2rem;
      border-bottom: 1px solid rgba(255, 111, 0, 0.3);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      cursor: pointer;
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #ff6f00, #ff9933);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 1rem;
      color: #121212;
    }

    .nav-links a {
      color: #ffffff;
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 0.5rem;
    }
    .nav-links a.active { background: rgba(255, 111, 0, 0.2); }
    .nav-links a:hover { background: rgba(255, 111, 0, 0.1); }

    /* Main Content Container */
    .main-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Dashboard & Card Styling */
    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 2rem;
      margin-bottom: 2rem;
    }

    .card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 1rem;
      padding: 1.5rem;
      border: 1px solid rgba(255, 111, 0, 0.15);
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.5);
    }

    .card h2, .card h3 {
      margin-bottom: 1rem;
      color: #ffffff;
    }

    /* Buttons */
    .btn {
      background: linear-gradient(135deg, #ff6f00, #ff9933);
      border: none;
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      color: #121212;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 0.5rem 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(255, 111, 0, 0.5);
    }
    .btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
      color: #ffffff;
    }
    .btn-secondary {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: #ffffff;
    }

    /* Landing Page Specific Styles */
    #landing-page { animation: fadeIn 0.5s ease-in-out; padding-top: 5rem; }
    .hero-section {
      text-align: center;
      padding: 4rem 2rem;
      margin-bottom: 3rem;
      background: radial-gradient(circle at center, rgba(255, 111, 0, 0.08), transparent 75%);
      border-radius: 1rem;
    }
    .hero-title {
      font-size: 3.5rem;
      font-weight: 900;
      margin-bottom: 1rem;
      line-height: 1.2;
      text-shadow: 0 0 15px rgba(255, 111, 0, 0.5);
    }
    .hero-subtitle {
      font-size: 1.5rem;
      max-width: 800px;
      margin: 0 auto 2rem;
      color: #b0b0b0;
    }

    /* Feature Cards */
    .feature-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 4rem;
    }
    .feature-card {
      background: rgba(255, 255, 255, 0.03);
      border-radius: 1rem;
      padding: 2rem;
      border-top: 3px solid transparent;
      text-align: center;
      transition: transform 0.3s ease, background 0.3s ease;
    }
    .feature-card:hover { transform: translateY(-5px); background: rgba(255, 255, 255, 0.05); }
    .feature-card.speed { border-top-color: #ff6f00; }
    .feature-card.accuracy { border-top-color: #00bfa6; }
    .feature-card.insight { border-top-color: #ffffff; }

    .feature-card i { font-size: 2.5rem; margin-bottom: 1rem; display: block; }
    .feature-card h3 { color: #ffffff; margin-bottom: 0.75rem; font-size: 1.5rem; }

    /* Dashboard View */
    #dashboard-page { display: none; animation: fadeIn 0.5s ease-in-out; }

    /* File Upload */
    .file-upload {
      border: 2px dashed rgba(255, 111, 0, 0.5);
      border-radius: 0.5rem;
      padding: 2rem;
      text-align: center;
      margin-bottom: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .file-upload:hover { border-color: rgba(255, 111, 0, 0.8); background: rgba(255, 111, 0, 0.1); }
    .upload-icon { font-size: 3rem; margin-bottom: 1rem; opacity: 0.9; color: #ff6f00; }

    /* Dataset Selector */
    .dataset-selector select {
      width: 100%;
      padding: 0.75rem;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 0.5rem;
      color: #ffffff;
      font-size: 1rem;
    }

    /* Status/Badge/Progress */
    .confidence-badge {
      background: linear-gradient(135deg, #00bfa6, #33d6c5);
      color: #121212;
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.875rem;
      font-weight: 600;
      display: inline-block;
    }
    .confidence-medium { background: linear-gradient(135deg, #ff6f00, #ff9933); }
    .confidence-low { background: linear-gradient(135deg, #dc2626, #ef4444); }

    .progress-bar { width: 100%; height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 4px; overflow: hidden; margin: 1rem 0; display: none; }
    .progress-fill { height: 100%; background: linear-gradient(90deg, #ff6f00, #ff9933); border-radius: 4px; width: 0%; }

    .status-success {
      background: rgba(0, 191, 166, 0.1);
      border: 1px solid rgba(0, 191, 166, 0.3);
      color: #00bfa6;
      padding: 0.5rem;
      border-radius: 0.5rem;
      margin-top: 1rem;
    }
    .status-processing {
      background: rgba(245, 158, 11, 0.1);
      border: 1px solid rgba(245, 158, 11, 0.3);
      color: #f59e0b;
      padding: 0.5rem;
      border-radius: 0.5rem;
      margin-top: 1rem;
    }

    .chart-placeholder {
      text-align: center;
      padding: 4rem 1rem;
      border: 2px dashed rgba(255, 111, 0, 0.3);
      border-radius: 0.75rem;
      opacity: 0.8;
      color: #b0b0b0;
    }

    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
    .stat-number { font-size: 2rem; font-weight: bold; color: #ffffff; display: block; }

    .candidate-card { background: rgba(255, 255, 255, 0.03); border-radius: 0.5rem; padding: 1rem; border-left: 4px solid #ff6f00; }
    .candidate-header { display: flex; justify-content: space-between; align-items: center; }

    .importance-bar { background: rgba(255, 255, 255, 0.1); height: 8px; border-radius: 4px; margin-top: 0.25rem; }
    .importance-fill { height: 100%; background: linear-gradient(90deg, #ff6f00, #ff9933); border-radius: 4px; }

    /* Animation Keyframes */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .dashboard-grid { grid-template-columns: 1fr; }
      .hero-title { font-size: 2.5rem; }
      .hero-subtitle { font-size: 1.2rem; }
      .header-content { flex-direction: column; gap: 1rem; }
      .nav-links { gap: 0.5rem; }
      #landing-page { padding-top: 2rem; }
      .hero-section { padding: 2rem 1rem; }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-content">
      <div class="logo" onclick="switchView('landing')">
        <div class="logo-icon">N</div>
        <div>
          <h1 class="text-white">Nalanda Nexus AI</h1>
          <p style="font-size: 0.875rem;">Exoplanet Discovery Platform</p>
        </div>
      </div>
      <nav class="nav-links">
        <a href="#" id="nav-landing" onclick="switchView('landing'); return false;">Home</a>
        <a href="#" id="nav-dashboard" onclick="switchView('dashboard'); return false;">Dashboard</a>
      </nav>
    </div>
  </header>

  <div class="main-container">
    <!-- ============================================== -->
    <!-- 1. LANDING PAGE VIEW (Default)                  -->
    <!-- ============================================== -->
    <div id="landing-page">
      <section class="hero-section">
        <h2 class="hero-title text-white">
          <span class="text-orange">10x Faster</span> Exoplanet Discovery. <br />
          <span class="text-teal">&gt;90% Accuracy.</span>
        </h2>
        <p class="hero-subtitle">
          Nalanda Nexus AI uses advanced deep learning to transform NASA's Kepler and TESS data into a
          <strong>fast, scalable, and highly accurate automated pipeline</strong>, moving you from data processing to scientific publication in hours, not weeks.
        </p>
        <button class="btn" onclick="switchView('dashboard')">
          Launch AI Discovery Platform <i class="fas fa-arrow-right" style="margin-left: 0.5rem;"></i>
        </button>
        <p style="margin-top: 1rem; font-size: 0.9rem;">Built for astrophysicists and space research organizations.</p>
      </section>

      <section class="feature-grid">
        <div class="feature-card speed">
          <i class="fas fa-rocket text-orange"></i>
          <h3 class="text-white">Unprecedented Speed</h3>
          <p>Automate noise reduction, normalization, and transit detection to achieve <strong>10x faster processing</strong> compared to traditional manual analysis methods.</p>
        </div>
        <div class="feature-card accuracy">
          <i class="fas fa-star text-teal"></i>
          <h3 class="text-white">High-Confidence Results</h3>
          <p>Leverage our CNN-based model with a <strong>&gt;90% accuracy target</strong> and integrated false-positive reduction algorithms for reliable candidate identification.</p>
        </div>
        <div class="feature-card insight">
          <i class="fas fa-brain text-white" style="color: #ff6f00;"></i>
          <h3 class="text-white">Interpretable AI</h3>
          <p>Gain <strong>transparent, explainable feature-importance</strong> insights to understand the detection logic and confidently support your scientific publications.</p>
        </div>
      </section>
    </div>

    <!-- ============================================== -->
    <!-- 2. DASHBOARD VIEW                               -->
    <!-- ============================================== -->
    <div id="dashboard-page">
      <!-- 🌌 Single Candidate Prediction Block -->
      <div class="card" style="margin-top: 1rem;">
        <h3>Single Candidate Prediction</h3>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem;">
          <input id="in-period" type="number" step="any" placeholder="Period (days)" value="3.0" />
          <input id="in-duration" type="number" step="any" placeholder="Duration (hours)" value="2.0" />
          <input id="in-depth" type="number" step="any" placeholder="Depth (ppm)" value="600" />
          <input id="in-snr" type="number" step="any" placeholder="SNR" value="12" />
          <input id="in-teff" type="number" step="any" placeholder="Teff (K)" value="5800" />
          <input id="in-mag" type="number" step="any" placeholder="Magnitude (T/Kep)" value="11.5" />
        </div>

        <div style="display: flex; gap: 0.5rem; margin-top: 0.75rem;">
          <input id="in-thr" type="number" step="any" placeholder="Decision Threshold (optional)" />
          <button class="btn" id="btn-score-one">Predict</button>
        </div>

        <pre id="one-out" style="margin-top: 0.75rem; background: #0e1627; padding: 8px; border-radius: 8px;"></pre>
      </div>

      <!-- Metrics & Visualizations -->
  <div class="card">
     <h3>Metrics (Labeled CSV)</h3>
  C:\Users\DELL\Documents\PROJECTS\NASA Space app<div style="font-size:12px;opacity:.8;margin-bottom:.25rem;">
    CSV must include: label, period_days, duration_hours, depth_ppm, snr, teff, mag
  </div>
  <input type="file" id="file-metrics" accept=".csv">
  <div style="display:flex; gap:.5rem; margin: .5rem 0;">
    <input id="thr-metrics" type="number" step="any" placeholder="Decision threshold (optional)">
    <button class="btn" id="btn-metrics">Compute Metrics</button>
  </div>
  <div style="display:grid; grid-template-columns: 2fr 1fr; gap: 12px;">
    <canvas id="prCanvas" width="700" height="340"></canvas>
    <canvas id="cmCanvas" width="320" height="320"></canvas>
  </div>
  <pre id="metrics-out" style="margin-top:.5rem;"></pre>
</div>
 

      <div class="dashboard-grid">
        <div class="card upload-section">
          <h2>Data Analysis &amp; Control</h2>

          <div class="dataset-selector">
            <label for="dataset-select" style="display: block; margin-bottom: 0.5rem; color: #b0b0b0;">Pre-loaded Datasets (Kepler/TESS):</label>
            <select id="dataset-select">
              <option value="">Select a dataset...</option>
              <option value="kepler-q1">Kepler Q1 Light Curves (100k+)</option>
              <option value="tess-s1">TESS Sector 1 (50k+)</option>
              <option value="mock-radial">Radial Velocity Mock Data</option>
            </select>
          </div>

          <div style="text-align: center; margin: 1rem 0; color: #b0b0b0;">OR</div>

          <div class="file-upload" id="file-upload">
            <div class="upload-icon">🔭</div>
            <p>Drop your NASA light curve files here</p>
            <p style="font-size: 0.875rem; color: #b0b0b0; opacity: 0.8; margin-top: 0.5rem;">Supports .fits, .csv formats (Batch capability included)</p>
            <input type="file" id="file-input" style="display: none;" multiple accept=".fits,.csv" />
          </div>

          <button class="btn" id="analyze-btn" disabled>🔍 Start AI Transit Detection</button>
          <button class="btn btn-secondary" id="batch-process-btn" disabled>📦 Run Large-Scale Batch Process</button>

          <div class="progress-bar" id="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
          </div>

          <div id="status-message"></div>
        </div>

        <div class="card results-section">
          <h2>Live Results &amp; Visualization</h2>
          <div id="results-content">
            <div class="chart-placeholder">
              <p style="font-size: 3rem; color: #ff6f00;">🌌</p>
              <p>Upload data or select a dataset to begin automated exoplanet discovery.</p>
              <p style="font-size: 0.875rem; color: #b0b0b0; opacity: 0.8; margin-top: 0.5rem;">(Initial detection model accuracy target: &gt;90%)</p>
            </div>
          </div>
        </div>
      </div>

      <div class="stats-grid" id="stats-grid" style="display: none;">
        <div class="card stat-card">
          <span class="stat-number" id="candidates-found">0</span>
          <span class="stat-label">Exoplanet Candidates Found</span>
        </div>
        <div class="card stat-card">
          <span class="stat-number" id="accuracy-rate">0%</span>
          <span class="stat-label">Model Accuracy Rate (Confirmed Exos)</span>
        </div>
        <div class="card stat-card">
          <span class="stat-number" id="processing-time">0s</span>
          <span class="stat-label">Total Processing Time (10x Faster Goal)</span>
        </div>
        <div class="card stat-card">
          <span class="stat-number" id="false-positives">0%</span>
          <span class="stat-label">False Positive Reduction (Baseline 40% Target)</span>
        </div>
      </div>

      <div class="card prd-summary" style="margin-bottom: 2rem;">
        <h2>Project Overview: Nalanda Nexus AI</h2>
        <p style="margin-bottom: 1.5rem; color: #b0b0b0;">
          <strong>TL;DR:</strong> Nalanda Nexus AI is an automated exoplanet discovery system that uses advanced deep learning to analyze NASA's Kepler and TESS datasets. Built for astrophysicists and space researchers, it transforms manual, error-prone exoplanet detection into a <strong>fast, scalable, and highly accurate automated pipeline</strong>, enabling researchers to discover more exoplanets while focusing on scientific insights rather than data processing.
        </p>
        <h3>Key Business Goals &amp; Functional Requirements (MVP)</h3>
        <ul style="list-style: disc; padding-left: 1.5rem; margin-top: 0.5rem; color: #b0b0b0; font-size: 0.95rem;">
          <li style="margin-bottom: 0.5rem;"><strong>Establishment:</strong> Lead automated exoplanet discovery for research organizations.</li>
          <li style="margin-bottom: 0.5rem;"><strong>Performance:</strong> Demonstrate <strong>10x faster processing speeds</strong> compared to manual methods.</li>
          <li style="margin-bottom: 0.5rem;"><strong>Solution:</strong> Create a scalable SaaS solution for astronomical data analysis.</li>
          <li style="margin-bottom: 0.5rem;"><strong>Core Functionality:</strong> Automated preprocessing pipeline for Kepler and TESS light curves.</li>
          <li style="margin-bottom: 0.5rem;"><strong>Model:</strong> CNN-based transit detection with a <strong>&gt;90% accuracy</strong> target on confirmed exoplanets.</li>
          <li style="margin-bottom: 0.5rem;"><strong>Interface:</strong> Interactive visualization dashboard and <strong>Batch Processing</strong> capability.</li>
        </ul>
      </div>

      <div class="card" id="candidates-section" style="display: none;">
        <h2>Confirmed Candidates for Peer Review</h2>
        <div class="results-grid" id="candidates-grid"></div>
      </div>

      <div class="card" id="interpretability-section" style="display: none;">
        <h2>AI Interpretability (Explainable Results)</h2>
        <p style="margin-bottom: 1rem; color: #b0b0b0;">Feature importance for the latest detection model (essential for scientific publication):</p>
        <div id="feature-importance"></div>
      </div>
    </div>
  </div>

  <script>
    // Global variables
    let analysisInProgress = false;
    let mockCandidates = [];

    // DOM elements
    const fileUpload = document.getElementById("file-upload");
    const fileInput = document.getElementById("file-input");
    const datasetSelect = document.getElementById("dataset-select");
    const analyzeBtn = document.getElementById("analyze-btn");
    const batchProcessBtn = document.getElementById("batch-process-btn");
    const progressBar = document.getElementById("progress-bar");
    const progressFill = document.getElementById("progress-fill");
    const statusMessage = document.getElementById("status-message");
    const resultsContent = document.getElementById("results-content");
    const statsGrid = document.getElementById("stats-grid");
    const candidatesSection = document.getElementById("candidates-section");
    const candidatesGrid = document.getElementById("candidates-grid");
    const interpretabilitySection = document.getElementById("interpretability-section");

    // Navigation Elements
    const landingPage = document.getElementById("landing-page");
    const dashboardPage = document.getElementById("dashboard-page");
    const navLanding = document.getElementById("nav-landing");
    const navDashboard = document.getElementById("nav-dashboard");

    // --- Navigation Logic ---
    function switchView(page) {
      if (page === "dashboard") {
        landingPage.style.display = "none";
        dashboardPage.style.display = "block";
        navLanding.classList.remove("active");
        navDashboard.classList.add("active");
      } else {
        landingPage.style.display = "block";
        dashboardPage.style.display = "none";
        navLanding.classList.add("active");
        navDashboard.classList.remove("active");
      }
    }

    // --- Event listeners ---
    fileUpload.addEventListener("click", () => fileInput.click());
    fileUpload.addEventListener("dragover", handleDragOver);
    fileUpload.addEventListener("drop", handleDrop);
    fileInput.addEventListener("change", handleFileSelect);
    datasetSelect.addEventListener("change", handleDatasetSelect);
    analyzeBtn.addEventListener("click", startAnalysis);
    batchProcessBtn.addEventListener("click", startBatchProcess);

    // --- Drag/Drop Handlers ---
    function handleDragOver(e) {
      e.preventDefault();
      // NASA Orange Highlight on Drag Over
      fileUpload.style.borderColor = "rgba(255, 111, 0, 0.8)";
      fileUpload.style.background = "rgba(255, 111, 0, 0.1)";
    }

    function handleDrop(e) {
      e.preventDefault();
      // Reset style
      fileUpload.style.borderColor = "rgba(255, 111, 0, 0.5)";
      fileUpload.style.background = "transparent";
      const files = e.dataTransfer.files;
      handleFiles(files);
    }

    function handleFileSelect(e) {
      const files = e.target.files;
      handleFiles(files);
    }

    function handleFiles(files) {
      if (files.length > 0) {
        updateStatus(`${files.length} file(s) selected. Ready to process.`, "success");
        analyzeBtn.disabled = false;
        batchProcessBtn.disabled = files.length <= 1;
      }
    }

    function handleDatasetSelect(e) {
      if (e.target.value) {
        updateStatus(`Selected: ${e.target.options[e.target.selectedIndex].text}. Ready for AI analysis.`, "success");
        analyzeBtn.disabled = false;
        batchProcessBtn.disabled = true; // Batch only for uploads/multi-selects
        fileInput.value = "";
      } else {
        analyzeBtn.disabled = true;
        batchProcessBtn.disabled = true;
      }
    }

    function updateStatus(message, type) {
      statusMessage.innerHTML = `<div class="status-${type}">${message}</div>`;
    }

    // --- Analysis Simulation ---
    function startAnalysis() {
      if (analysisInProgress) return;

      analysisInProgress = true;
      analyzeBtn.disabled = true;
      batchProcessBtn.disabled = true;
      datasetSelect.disabled = true;

      updateStatus("Initializing AI models (CNN & RNN)...", "processing");
      progressBar.style.display = "block";

      simulateAnalysis();
    }

    function startBatchProcess() {
      if (analysisInProgress) return;

      analysisInProgress = true;
      analyzeBtn.disabled = true;
      batchProcessBtn.disabled = true;
      datasetSelect.disabled = true;

      updateStatus("Starting large-scale batch processing...", "processing");
      progressBar.style.display = "block";

      simulateBatchAnalysis();
    }

    function simulateAnalysis() {
      let idx = 0;
      const steps = [
        { progress: 20, message: "Preprocessing light curve data (Noise reduction & Normalization)..." },
        { progress: 40, message: "Running CNN transit detection model (90% target accuracy)..." },
        { progress: 65, message: "Applying False Positive Reduction Algorithms (40% target improvement)..." },
        { progress: 90, message: "Generating AI interpretability insights..." },
        { progress: 100, message: "Analysis complete. Displaying findings!" }
      ];

      function nextStep() {
        if (idx < steps.length) {
          const step = steps[idx];
          progressFill.style.width = step.progress + "%";
          updateStatus(step.message, "processing");
          idx++;
          setTimeout(nextStep, 1000);
        } else {
          completeAnalysis();
        }
      }

      nextStep();
    }

    function simulateBatchAnalysis() {
      let processed = 0;
      const totalFiles = 10;

      function processNextFile() {
        if (processed < totalFiles) {
          processed++;
          const progressPercent = (processed / totalFiles) * 100;
          progressFill.style.width = progressPercent + "%";
          updateStatus(`Processing file ${processed} of ${totalFiles} in batch...`, "processing");
          setTimeout(processNextFile, 700);
        } else {
          completeAnalysis();
        }
      }

      processNextFile();
    }

    function completeAnalysis() {
      updateStatus("✅ Analysis completed successfully! Review new candidates.", "success");

      setTimeout(() => {
        progressBar.style.display = "none";
        progressFill.style.width = "0%";
        analysisInProgress = false;
        analyzeBtn.disabled = false;
        batchProcessBtn.disabled = false;
        datasetSelect.disabled = false;

        generateMockResults();
        displayResults();
      }, 500);
    }

    // --- Mock Data Generation ---
    function generateMockResults() {
      mockCandidates = [
        {
          id: "KIC-8462852 (Candidate 1)",
          confidence: 0.96,
          period: "20.3 days",
          radius: "1.4 R⊕ (Super Earth)",
          temperature: "255 K (Habitable Zone)"
        },
        {
          id: "TOI-715.01 (Candidate 2)",
          confidence: 0.88,
          period: "19.3 days",
          radius: "1.07 R⊕ (Earth-size)",
          temperature: "280 K (TESS Target)"
        },
        {
          id: "KIC-12557548 (Candidate 3)",
          confidence: 0.72,
          period: "15.7 hours",
          radius: "0.67 R⊕",
          temperature: "2000 K (Requires follow-up)"
        }
      ];
    }

    // --- Results Display ---
    function displayResults() {
      // Update stats based on PRD goals
      document.getElementById("candidates-found").textContent = mockCandidates.length;
      document.getElementById("accuracy-rate").textContent = "94.2%";
      document.getElementById("processing-time").textContent = "12.3s";
      document.getElementById("false-positives").textContent = "8.7%";

      statsGrid.style.display = "grid";

      // Display live chart
      resultsContent.innerHTML = `
        <div class="chart-container">
          <canvas id="lightCurveChart" width="400" height="300"></canvas>
        </div>
      `;

      drawMockChart();

      // Display candidates
      candidatesGrid.innerHTML = "";
      mockCandidates.forEach((candidate) => {
        const confidenceClass =
          candidate.confidence > 0.9 ? "confidence-high" : candidate.confidence > 0.8 ? "confidence-medium" : "confidence-low";

        const candidateEl = document.createElement("div");
        candidateEl.className = "candidate-card";
        candidateEl.innerHTML = `
          <div class="candidate-header">
            <h4>${candidate.id}</h4>
            <div class="confidence-badge ${confidenceClass}">
              ${Math.round(candidate.confidence * 100)}% confidence
            </div>
          </div>
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1rem; font-size: 0.9rem;">
            <div>
              <strong>Period:</strong><br />
              <span style="color: #ff6f00;">${candidate.period}</span>
            </div>
            <div>
              <strong>Radius:</strong><br />
              <span style="color: #ff6f00;">${candidate.radius}</span>
            </div>
            <div>
              <strong>Temperature:</strong><br />
              <span style="color: #ff6f00;">${candidate.temperature}</span>
            </div>
          </div>
        `;
        candidatesGrid.appendChild(candidateEl);
      });

      candidatesSection.style.display = "block";

      // Display interpretability
      displayFeatureImportance();
      interpretabilitySection.style.display = "block";
    }

    // --- Chart Drawing (using Canvas 2D) ---
    function drawMockChart() {
      const canvas = document.getElementById("lightCurveChart");
      if (!canvas) return; // Safety check
      const ctx = canvas.getContext("2d");

      // Set canvas size (Responsive scaling simplified for demo)
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;

      // Clear canvas - slightly lighter dark color than body
      ctx.fillStyle = "rgba(255, 255, 255, 0.05)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      const padding = 50;
      const chartWidth = canvas.width - 2 * padding;
      const chartHeight = canvas.height - 2 * padding;

      // Draw axes
      ctx.strokeStyle = "rgba(255, 255, 255, 0.3)";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.moveTo(padding, padding + chartHeight);
      ctx.lineTo(padding + chartWidth, padding + chartHeight);
      ctx.moveTo(padding, padding);
      ctx.lineTo(padding, padding + chartHeight);
      ctx.stroke();

      // Labels
      ctx.fillStyle = "#b0b0b0";
      ctx.font = "12px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("Time (Phase)", padding + chartWidth / 2, canvas.height - 10);

      ctx.save();
      ctx.translate(15, canvas.height / 2);
      ctx.rotate(-Math.PI / 2);
      ctx.textAlign = "center";
      ctx.fillText("Relative Flux / Brightness", 0, 0);
      ctx.restore();

      // Mock light curve with transit
      ctx.strokeStyle = "#ff6f00"; // NASA Orange
      ctx.lineWidth = 2;
      ctx.beginPath();

      const points = 300;
      for (let i = 0; i < points; i++) {
        const x = padding + (i / points) * chartWidth;
        let y = padding + chartHeight / 2 + Math.sin(i * 0.02) * 5 + Math.random() * 4 - 2;
        // Transit dip
        if (i > 120 && i < 150) y += 30;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      }
      ctx.stroke();

      // Highlight transit region
      ctx.fillStyle = "rgba(255, 111, 0, 0.3)";
      const transitStart = padding + (120 / points) * chartWidth;
      const transitWidth = (30 / points) * chartWidth;
      ctx.fillRect(transitStart, padding, transitWidth, chartHeight);

      // Title
      ctx.fillStyle = "#ffffff";
      ctx.font = "16px sans-serif";
      ctx.fillText("Detected Exoplanet Transit Signature", canvas.width / 2, 30);
    }

    // --- Interpretability Display ---
    function displayFeatureImportance() {
      const features = [
        { name: "Transit Depth (Relative Flux Drop)", importance: 0.95 },
        { name: "Transit Duration (Time in front of star)", importance: 0.87 },
        { name: "Periodicity & Stability (Orbital Reliability)", importance: 0.78 },
        { name: "Signal-to-Noise Ratio (SNR)", importance: 0.72 },
        { name: "Baseline Stability (Stellar Noise)", importance: 0.65 }
      ];

      const container = document.getElementById("feature-importance");
      if (!container) return;

      container.innerHTML = "";
      features.forEach((feature) => {
        const featureEl = document.createElement("div");
        featureEl.className = "feature-importance";
        featureEl.innerHTML = `
          <span style="display: block; font-size: 0.9rem; margin-bottom: 0.25rem;">${feature.name}</span>
          <div class="importance-bar">
            <div class="importance-fill" style="width: ${feature.importance * 100}%"></div>
          </div>
        `;
        container.appendChild(featureEl);
      });
    }

    // Initialize the page status and set the default view to 'landing'
    document.addEventListener("DOMContentLoaded", function () {
      updateStatus("Welcome to Nalanda Nexus AI! Upload or select data to begin discovery.", "success");
      switchView("landing");
    });
  </script>

  <!-- Predict-Single Integration Script (FastAPI) -->
  <script>
    // Tell the HTML where your local FastAPI is running
    const BASE_URL = "https://nalandanexusai-api.onrender.com"; // change if using a public tunnel

    // Add click listener for the Predict button
    document.getElementById("btn-score-one").addEventListener("click", async () => {
      const payload = {
        period_days: parseFloat(document.getElementById("in-period").value),
        duration_hours: parseFloat(document.getElementById("in-duration").value),
        depth_ppm: parseFloat(document.getElementById("in-depth").value),
        snr: parseFloat(document.getElementById("in-snr").value),
        teff: parseFloat(document.getElementById("in-teff").value),
        mag: parseFloat(document.getElementById("in-mag").value),
        threshold: document.getElementById("in-thr").value ? parseFloat(document.getElementById("in-thr").value) : null
      };

      try {
        const res = await fetch(`${BASE_URL}/api/predict-single`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        // Handle non-2xx responses gracefully
        if (!res.ok) {
          const text = await res.text();
          throw new Error(`Server responded ${res.status}: ${text}`);
        }

        const data = await res.json();
        document.getElementById("one-out").textContent = JSON.stringify(data, null, 2);
      } catch (err) {
        document.getElementById("one-out").textContent = "Error: " + err.message;
      }
    });
  </script>
  <script>
/* ============================
   METRICS: PR Curve + Confusion Matrix
   Works with /api/predict-batch that returns JSON { ok, threshold_used, csv }
   CSV must contain at least: label, period_days, duration_hours, depth_ppm, snr, teff, mag
   Server adds: p_planet (probability), label_pred (0/1) for the chosen threshold.
============================ */

// Wire the "Compute Metrics" button
document.getElementById("btn-metrics").addEventListener("click", async () => {
  const fileEl = document.getElementById("file-metrics");
  const thrEl  = document.getElementById("thr-metrics");
  const outEl  = document.getElementById("metrics-out");

  if (!fileEl.files || fileEl.files.length === 0) {
    outEl.textContent = "Please choose a labeled CSV file first.";
    return;
  }

  try {
    const form = new FormData();
    form.append("file", fileEl.files[0]);
    if (thrEl.value) form.append("threshold", thrEl.value);

    const res = await fetch(`${BASE_URL}/api/predict-batch`, {
      method: "POST",
      body: form
    });
    if (!res.ok) {
      const text = await res.text();
      throw new Error(`Server responded ${res.status}: ${text}`);
    }
    const data = await res.json();
    if (!data.ok) throw new Error("Backend returned ok=false");

    // Parse CSV from response
    const parsed = parseCSV(data.csv);
    const headers = parsed.headers;
    const rows = parsed.rows;

    // Required columns
    const colLabel   = "label";
    const colScore   = "p_planet";    // produced by backend
    const colPred    = "label_pred";  // produced by backend

    if (!headers.includes(colLabel) || !headers.includes(colScore)) {
      throw new Error(`CSV missing required columns. Found: ${headers.join(", ")}`);
    }

    // Extract arrays
    const yTrue  = rows.map(r => +r[colLabel]);
    const yScore = rows.map(r => +r[colScore]);
    const thrUsed = (data.threshold_used !== undefined) ? +data.threshold_used
                    : (thrEl.value ? +thrEl.value : 0.5);

    // Compute PR curve (sorted by score desc)
    const pr = computePrecisionRecall(yTrue, yScore);
    drawPRCurve("prCanvas", pr.precision, pr.recall);

    // Confusion matrix at threshold
    const cm = computeConfusionMatrix(yTrue, yScore, thrUsed);
    drawConfusionMatrix("cmCanvas", cm);

    // Summary text
    const ap = approximateAveragePrecision(pr.precision, pr.recall);
    const f1 = f1FromCM(cm);
    outEl.textContent =
      `Threshold used: ${thrUsed.toFixed(3)}\n` +
      `PR-AUC (approx): ${ap.toFixed(4)}\n` +
      `Confusion Matrix at thr=${thrUsed.toFixed(3)}  [TN=${cm.tn}, FP=${cm.fp}, FN=${cm.fn}, TP=${cm.tp}]\n` +
      `Precision: ${cm.precision.toFixed(4)}, Recall: ${cm.recall.toFixed(4)}, F1: ${f1.toFixed(4)}\n` +
      `N = ${yTrue.length}`;
  } catch (err) {
    document.getElementById("metrics-out").textContent = "Error: " + err.message;
    console.error(err);
  }
});

/* ---------- CSV Parser (simple, RFC-light) ---------- */
function parseCSV(text) {
  // Basic parser (assumes no quoted commas in fields).
  // If you need full CSV edge cases, swap in a library like PapaParse.
  const lines = text.trim().split(/\r?\n/);
  const headers = lines[0].split(",").map(h => h.trim());
  const rows = [];
  for (let i = 1; i < lines.length; i++) {
    if (!lines[i].trim()) continue;
    const parts = lines[i].split(",");
    const obj = {};
    headers.forEach((h, idx) => { obj[h] = parts[idx] !== undefined ? parts[idx].trim() : ""; });
    rows.push(obj);
  }
  return { headers, rows };
}

/* ---------- Precision-Recall ---------- */
function computePrecisionRecall(yTrue, yScore) {
  // Sort by score descending
  const idx = yScore.map((s, i) => i).sort((a, b) => yScore[b] - yScore[a]);
  let tp = 0, fp = 0, fn = 0, tn = 0;

  const totalPos = yTrue.reduce((a, b) => a + (b === 1 ? 1 : 0), 0);
  const totalNeg = yTrue.length - totalPos;

  const precision = [];
  const recall    = [];

  for (let k = 0; k < idx.length; k++) {
    const i = idx[k];
    if (yTrue[i] === 1) tp++; else fp++;
    const prec = tp / Math.max(tp + fp, 1);
    const rec  = tp / Math.max(totalPos, 1);
    precision.push(prec);
    recall.push(rec);
  }

  // Add (0,1) start point if desired — not necessary for plotting but can be included
  return { precision, recall };
}

function approximateAveragePrecision(precision, recall) {
  // Compute area under PR curve using the standard step-wise interpolation
  // Sort by recall ascending (defensive)
  const pairs = recall.map((r, i) => ({ r, p: precision[i] }))
                      .sort((a, b) => a.r - b.r);

  let area = 0;
  for (let i = 1; i < pairs.length; i++) {
    const dr = Math.max(pairs[i].r - pairs[i - 1].r, 0);
    // accumulate using precision at i (sklearn uses a specific interpolation; this is a close approx)
    area += pairs[i].p * dr;
  }
  return area;
}

/* ---------- Confusion Matrix at threshold ---------- */
function computeConfusionMatrix(yTrue, yScore, thr) {
  let tp = 0, fp = 0, tn = 0, fn = 0;
  for (let i = 0; i < yTrue.length; i++) {
    const pred = (yScore[i] >= thr) ? 1 : 0;
    if (pred === 1 && yTrue[i] === 1) tp++;
    else if (pred === 1 && yTrue[i] === 0) fp++;
    else if (pred === 0 && yTrue[i] === 1) fn++;
    else tn++;
  }
  const precision = tp / Math.max(tp + fp, 1);
  const recall    = tp / Math.max(tp + fn, 1);
  const acc       = (tp + tn) / Math.max(yTrue.length, 1);
  return { tp, fp, tn, fn, precision, recall, acc };
}

function f1FromCM(cm) {
  const p = cm.precision, r = cm.recall;
  return (2 * p * r) / Math.max(p + r, 1e-9);
}

/* ---------- Draw PR Curve (Canvas 2D) ---------- */
function drawPRCurve(canvasId, precision, recall) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  const ctx = canvas.getContext('2d');

  // Clear
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const W = canvas.width, H = canvas.height;
  const pad = 40;

  // Background
  ctx.fillStyle = "rgba(255,255,255,0.05)";
  ctx.fillRect(0, 0, W, H);

  // Axes
  ctx.strokeStyle = "rgba(255,255,255,0.35)";
  ctx.lineWidth = 1;
  ctx.beginPath();
  ctx.moveTo(pad, H - pad);
  ctx.lineTo(W - pad, H - pad);
  ctx.moveTo(pad, pad);
  ctx.lineTo(pad, H - pad);
  ctx.stroke();

  // Axis labels
  ctx.fillStyle = "#B0B0B0";
  ctx.font = "12px sans-serif";
  ctx.textAlign = "center";
  ctx.fillText("Recall", (W / 2), H - 8);
  ctx.save();
  ctx.translate(14, H / 2);
  ctx.rotate(-Math.PI / 2);
  ctx.fillText("Precision", 0, 0);
  ctx.restore();

  // Tick marks (0, 0.5, 1)
  ctx.fillStyle = "#888";
  ctx.textAlign = "right";
  for (let t of [0, 0.5, 1]) {
    const y = H - pad - t * (H - 2 * pad);
    ctx.fillText(t.toFixed(1), pad - 6, y + 3);
    ctx.beginPath();
    ctx.moveTo(pad - 3, y);
    ctx.lineTo(pad, y);
    ctx.stroke();
  }
  ctx.textAlign = "center";
  for (let t of [0, 0.5, 1]) {
    const x = pad + t * (W - 2 * pad);
    ctx.fillText(t.toFixed(1), x, H - pad + 14);
    ctx.beginPath();
    ctx.moveTo(x, H - pad);
    ctx.lineTo(x, H - pad + 3);
    ctx.stroke();
  }

  // PR polyline
  ctx.strokeStyle = "#FF6F00"; // NASA Orange
  ctx.lineWidth = 2;
  ctx.beginPath();
  for (let i = 0; i < precision.length; i++) {
    const x = pad + (recall[i] * (W - 2 * pad));
    const y = H - pad - (precision[i] * (H - 2 * pad));
    if (i === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  }
  ctx.stroke();

  // Title
  ctx.fillStyle = "#FFFFFF";
  ctx.font = "14px sans-serif";
  ctx.fillText("Precision–Recall Curve", W / 2, 18);
}

/* ---------- Draw Confusion Matrix (2x2) ---------- */
function drawConfusionMatrix(canvasId, cm) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  const ctx = canvas.getContext('2d');

  // Clear
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const W = canvas.width, H = canvas.height;
  const pad = 16;

  // Title
  ctx.fillStyle = "#FFFFFF";
  ctx.font = "14px sans-serif";
  ctx.fillText("Confusion Matrix", W / 2, 18);

  // Grid area
  const gridX = pad + 50;
  const gridY = pad + 30;
  const cellW = (W - gridX - pad) / 2;
  const cellH = (H - gridY - pad) / 2;

  // Labels
  ctx.fillStyle = "#B0B0B0";
  ctx.font = "12px sans-serif";
  ctx.fillText("Predicted", gridX + cellW, gridY - 10);
  ctx.save();
  ctx.translate(gridX - 30, gridY + cellH);
  ctx.rotate(-Math.PI / 2);
  ctx.fillText("Actual", 0, 0);
  ctx.restore();

  ctx.fillText("0", gridX + cellW * 0.5, gridY - 10);
  ctx.fillText("1", gridX + cellW * 1.5, gridY - 10);
  ctx.fillText("0", gridX - 10, gridY + cellH * 0.5);
  ctx.fillText("1", gridX - 10, gridY + cellH * 1.5);

  // Cells (TN, FP, FN, TP)
  const cells = [
    { x: gridX,         y: gridY,          v: cm.tn, label: "TN" },
    { x: gridX + cellW, y: gridY,          v: cm.fp, label: "FP" },
    { x: gridX,         y: gridY + cellH,  v: cm.fn, label: "FN" },
    { x: gridX + cellW, y: gridY + cellH,  v: cm.tp, label: "TP" },
  ];

  cells.forEach(c => {
    // fill
    ctx.fillStyle = "rgba(255, 111, 0, 0.25)"; // NASA Orange lite
    ctx.fillRect(c.x, c.y, cellW, cellH);
    // border
    ctx.strokeStyle = "rgba(255,255,255,0.3)";
    ctx.strokeRect(c.x, c.y, cellW, cellH);
    // text
    ctx.fillStyle = "#FFFFFF";
    ctx.font = "bold 16px sans-serif";
    ctx.textAlign = "center";
    ctx.fillText(`${c.label}: ${c.v}`, c.x + cellW / 2, c.y + cellH / 2);
  });

  // Footer metrics
  ctx.fillStyle = "#B0B0B0";
  ctx.font = "12px sans-serif";
  const line1 = `Precision: ${cm.precision.toFixed(3)}   Recall: ${cm.recall.toFixed(3)}   Accuracy: ${cm.acc.toFixed(3)}`;
  ctx.fillText(line1, W / 2, H - 10);
}
</script>

</body>
</html>


